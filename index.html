<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mix électrique français – Visualisation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Feuille de style principale -->
  <link rel="stylesheet" href="style.css" />

  <!-- D3.js v7 -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
  <!-- ============================= -->
  <!-- NAVBAR                       -->
  <!-- ============================= -->
  <nav class="navbar">
    <div class="navbar-left">
      <div class="brand-dot"></div>
      <div>
        <div class="navbar-title">Mix électrique français</div>
        <div class="navbar-subtitle">
          Visualisation pédagogique - données RTE éco2mix
        </div>
      </div>
    </div>
    <div class="navbar-right">
      <div class="nav-link primary">Projet - Lyon1 - Groupe 14</div>
    </div>
  </nav>

  <!-- ============================= -->
  <!-- CONTENU PRINCIPAL            -->
  <!-- ============================= -->
  <main class="page">
    <header class="page-header">
      <h1>Visualisation de l'électricité française</h1>
      <p>
        Tableau de bord interactif sur le mix électrique français (données RTE éCO2mix).
        Il regroupe : (1) l’équilibre consommation/production avec prévision J-1,
        (2) les interconnexions et l’intensité carbone, (3) des vues de profil (journalier, semaine/week-end),
        (4) la saisonnalité des renouvelables, (5) la production par filière.
      </p>

      <ul class="bullet-list" style="margin-top: 10px;">
        <li><strong>Choisir une vue :</strong> basculez <em>Jour</em> / <em>Mois</em> selon la section.</li>
        <li><strong>Naviguer dans le temps :</strong> utilisez le <em>slider</em> pour parcourir 2025 (jour par jour ou mois par mois).</li>
        <li><strong>Lire les graphiques :</strong> survolez pour afficher les valeurs, et consultez l’<em>analyse automatique</em> à droite (moyennes, pic, déficit).</li>
        <li><strong>Comparer facilement :</strong> Tous les graphiques analytiques sont regroupés sur une seule page.</li>
      </ul>
    </header>


    <!-- ===================================================== -->
    <!-- SECTION 1 – Courbe de charge / production (Jour/Mois) -->
    <!-- ===================================================== -->
    <section class="viz-section" id="section-day-balance">
      <!-- --------- Colonne gauche : graphique D3 ------------ -->
      <div class="viz-left">
        <div>
          <div class="section-title">
            <span id="modeTitlePrefix">Courbe de charge &amp; production –</span>
            <span id="titleDay"></span>
          </div>
          <div class="section-subtitle" id="subtitleText">
            Pas de temps : 15 minutes – données France entière (vue journalière).
          </div>
        </div>

        <svg id="dayChart" width="100%" height="380"></svg>

        <!-- Légende des courbes -->
        <div class="legend" id="legend">
          <div class="legend-item">
            <div class="legend-color blue"></div>
            <span>Consommation réelle</span>
          </div>
          <div class="legend-item">
            <div class="legend-color orange"></div>
            <span>Production totale</span>
          </div>
          <div class="legend-item legend-forecast">
            <div class="legend-color gray-dash"></div>
            <span>Prévision J-1</span>
          </div>
        </div>

        <!-- Contrôles : mode Jour / Mois + slider temporel -->
        <div class="controls">
          <div class="controls-left">
            <span class="tag">Mode</span>
            <button id="modeDay" class="toggle-btn active">Jour</button>
            <button id="modeMonth" class="toggle-btn">Mois</button>
          </div>
          <div class="controls-right">
            <span id="sliderLabel" class="slider-label"></span>
            
            <div class="controls-right">
              <span id="sliderLabel" class="slider-label"></span>
              
              <div class="slider-wrapper">
                  <span id="consoStart" class="slider-bound start">2025-01-01</span>
                  <input type="range" id="timeSlider" min="0" max="0" value="0" />
                  <span id="consoEnd" class="slider-bound end">2025-11-27</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- --------- Colonne droite : analyse texte ------------ -->
      <aside class="viz-right">
        <div class="explanation-header">Analyse automatique</div>
        <div class="explanation-body" id="analysisText">
          Chargement des données…
        </div>

        <div class="metric-row">
          <div class="metric-label">Pic de consommation</div>
          <div class="metric-value" id="metricPeak"></div>
        </div>

        <div class="metric-row">
          <div class="metric-label">
            Déficit maximal (consommation &gt; production)
          </div>
          <div class="metric-value" id="metricDeficit"></div>
        </div>

        <!-- Ce bloc doit disparaître en mode mensuel -->
        <div class="metric-row" id="metricForecastRow">
          <div class="metric-label">Écart moyen prévision J-1 vs réel</div>
          <div class="metric-value" id="metricForecastError"></div>
        </div>

        <ul class="bullet-list" id="bulletList">
          <li>
            La zone où la courbe bleue dépasse l'orange correspond aux moments
            où la France doit augmenter ses imports ou activer du gaz / fioul.
          </li>
          <li>
            Comparez les jours d’hiver et d’été pour observer l’impact du
            chauffage électrique sur le pic de 19&nbsp;h.
          </li>
        </ul>
      </aside>
    </section>

    <section class="viz-section" style="margin-top: 28px;">
      <div class="viz-left" style="flex: 1.6;">
        <div>
          <div class="section-title">
            <span id="fluxTitlePrefix">Interconnexions :</span>
            <span id="fluxTitleDate">Chargement...</span>
          </div>
          <div class="section-subtitle">Visualisation des échanges transfrontaliers et de l'intensité carbone française.</div>
        </div>

        <div class="story-controls">
            <button class="btn-story" data-target="event1">❄️ Pic Hiver</button>
            <button class="btn-story" data-target="event2">☀️ Creux Été</button>
            <button class="btn-story" data-target="event3">⚡ Record Export</button>
        </div>

        <div class="legend" style="margin-bottom: 5px;">
            <div class="legend-item">
                    <span style="color:#2ecc71; font-weight:bold; font-size:1.2em;">&#8594;</span> 
                    <span>Export (Vente)</span>
                </div>
                <div class="legend-item">
                    <span style="color:#e74c3c; font-weight:bold; font-size:1.2em;">&#8594;</span> 
                    <span>Import (Achat)</span>
                </div>
                <div class="legend-item" style="margin-left:15px;">
                    <span class="legend-color-flux" style="background: linear-gradient(90deg, #2ecc71, #f1c40f, #e74c3c); width: 40px; border-radius:2px;"></span>
                    France (Intensité CO2)
            </div>
        </div>

        <div id="flux-chart" class="viz-container">
            <div id="tooltip-flux"></div>
        </div>

        <div class="controls" style="margin-top:15px;">
          <div class="controls-left">
            <span class="tag">Mode</span>
            <button id="modeDayFlux" class="toggle-btn active">Jour</button>
            <button id="modeMonthFlux" class="toggle-btn">Mois</button>
          </div>
          <div class="controls-right">
              <span id="sliderLabelFlux" class="slider-label">Jour : -</span>
              
              <div class="slider-wrapper">
                  <span id="fluxStartBound" class="slider-bound start"></span>
                  <input type="range" id="timeSliderFlux" min="0" max="0" value="0" />
                  <span id="fluxEndBound" class="slider-bound end"></span>
              </div>
          </div>
        </div>
      </div>

      <aside class="viz-right" style="flex: 1;">
        <div class="explanation-header">Analyse des flux</div>
        <div class="explanation-body" id="fluxAnalysisText">Chargement des données...</div>
        <br>

        <div class="metric-row">
            <div class="metric-label">Solde Commercial (Total sur la journée)</div>
            <div class="metric-value" id="fluxMetricBalance">-</div>
        </div>
        <div class="metric-row">
            <div class="metric-label">Partenaire Principal (Vol. Max)</div>
            <div class="metric-value" id="fluxMetricPartner">-</div>
        </div>
        <div class="metric-row">
            <div class="metric-label">Intensité Carbone (Prod. FR)</div>
            <div class="metric-value" id="fluxMetricCO2">-</div>
        </div>

        <div id="history-chart-container">
            <div class="explanation-header" style="font-size:0.8rem; margin-bottom:5px;">Contexte (Échange sur les 7 derniers jours)</div>
            <svg id="history-chart" width="100%" height="80"></svg>
        </div>

        <ul class="bullet-list" id="fluxBulletList">
            <li><strong>Animation :</strong> La vitesse des particules représente l'intensité des échanges.</li>
            <li><strong>Couleur Pays :</strong> La France change selon son CO2. Les voisins deviennent <span style="color:#e74c3c">rouges</span> si on importe de l'énergie <span style="color:#2ecc71">verts</span> si on en exporte.</li>
        </ul>
      </aside>
    </section>
      <!-- ===================================================== -->
      <section class="viz-section">

        <iframe
          src="profile.html?embed=1"
          scrolling="no"
          style="
            width: 100%;
            height: 700px;
            border: none;
            border-radius: 12px;
            background: white;
          "
        ></iframe>
      
      </section>
      <section class="viz-section">

        <iframe
          src="weekday_weekend.html?embed=1"
          scrolling="no"
          style="
            width: 100%;
            height: 700px;
            border: none;
            border-radius: 12px;
            background: white;
          "
        ></iframe>
      
      </section>
            
      

      <section class="viz-section" id="seasonalRenewSection" style="margin-top: 28px;">
        <div class="viz-left">
          <div>
            <div class="section-title">Renouvelables – comparaison par saison</div>
            <div class="section-subtitle">Unités : GWh (énergie totale par saison).</div>
          </div>

          <svg id="sBarChart" width="100%" height="380"></svg>
          <div class="legend" id="sLegend"></div>
        </div>

        <aside class="viz-right">
          <div class="explanation-header">Analyse</div>
          <p class="story-paragraph" id="seasonStory"></p>
          <div class="story-cards" id="seasonCards"></div>
        </aside>
      </section>

<div class="s-tooltip" id="sTooltip"></div>

<section class="viz-section" id="f-section-prod" style="margin-top: 28px;">
  <div class="viz-left">
    <div>
      <div class="section-title">
        <span id="fTitlePrefix">Production par filière –</span>
        <span id="fTitleValue"></span>
      </div>
      <div class="section-subtitle" id="fSubtitle">
        Survol : barre verticale + valeurs. Clic légende : solo/reset.
      </div>
    </div>

    <svg id="fAreaChart" width="100%" height="380"></svg>

    <div class="legend" id="fLegend"></div>

    <div class="controls">
      <div class="controls-left">
        <span class="tag">Mode</span>
        <button id="fModeDay" class="toggle-btn active">Jour</button>
        <button id="fModeMonth" class="toggle-btn">Mois</button>
      </div>
      <div class="controls-right">
        <span id="fSliderLabel" class="slider-label"></span>
        
        <div class="slider-wrapper">
            <span id="prodStart" class="slider-bound start">2025-01-01</span>
            <input type="range" id="fTimeSlider" min="0" max="0" value="0" />
            <span id="prodEnd" class="slider-bound end">2025-12-15</span>
        </div>
      </div>
    </div>
  </div>

  <aside class="viz-right">
    <div class="explanation-header">Analyse automatique</div>

    <div class="explanation-body" id="prodText">
      Répartition de la production par filière sur la période sélectionnée.
    </div>

    <div style="display:flex; justify-content:center; margin: 12px 0;">
      <svg id="prodDonut" width="260" height="220"></svg>
    </div>

    <div class="metric-row">
      <div class="metric-label">Total énergie (période)</div>
      <div class="metric-value" id="prodTotalEnergy">-</div>
    </div>

    <ul class="bullet-list" id="prodDonutLegend"></ul>
  </aside>
</section>

<div class="f-tooltip" id="fTooltip"></div>
  </main>

  <script src="js/viz_conso.js"></script>
  <script src="js/viz_flux.js"></script>
  <script src="js/viz_seasonal_renew.js"></script>
  <script src="js/viz_prod_filiere.js"></script>
 

  <script src="js/main.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
        // Les textes à afficher selon le mode
        const dates = {
            day: { start: "2025-01-01", end: "2025-11-27" },
            month: { start: "2025-01", end: "2025-11" }
        };
        const dates2 = {
            day: { start: "2025-01-01", end: "2025-12-15" },
            month: { start: "2025-01", end: "2025-12" }
        };

        // GRAPHIQUE 1 (Conso)
        const updateConso = (mode) => {
            document.getElementById("consoStart").textContent = dates[mode].start;
            document.getElementById("consoEnd").textContent = dates[mode].end;
        };
        // On écoute les boutons existants
        document.getElementById("modeDay").addEventListener("click", () => updateConso("day"));
        document.getElementById("modeMonth").addEventListener("click", () => updateConso("month"));

        // GRAPHIQUE 3 (Production)
        const updateProd = (mode) => {
            document.getElementById("prodStart").textContent = dates2[mode].start;
            document.getElementById("prodEnd").textContent = dates2[mode].end;
        };
        // On écoute les boutons existants
        document.getElementById("fModeDay").addEventListener("click", () => updateProd("day"));
        document.getElementById("fModeMonth").addEventListener("click", () => updateProd("month"));
    });
  </script>
</body>
</html>
